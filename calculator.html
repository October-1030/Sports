<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Orange Harmony è¯„åˆ†è®¡ç®—å™¨ - ç®¡ç†åå°</title>
    <!-- PDFå¯¼å‡ºåº“ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        :root {
            --primary: #f97316;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --bg: #f1f5f9;
            --card: #ffffff;
            --text: #1e293b;
            --muted: #64748b;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            margin-bottom: 8px;
            color: var(--text);
        }

        .subtitle {
            text-align: center;
            color: var(--muted);
            margin-bottom: 24px;
            font-size: 14px;
        }

        .layout {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
        }

        @media (max-width: 900px) {
            .layout {
                grid-template-columns: 1fr;
            }
        }

        .panel {
            background: var(--card);
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .panel-title {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 2px solid #e2e8f0;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .section {
            margin-bottom: 20px;
        }

        .section-label {
            font-size: 12px;
            font-weight: 600;
            color: var(--muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }

        .input-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 12px;
        }

        .input-group {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .input-group label {
            font-size: 12px;
            color: var(--muted);
        }

        .input-group input,
        .input-group select {
            padding: 8px 12px;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            font-size: 14px;
            background: #f8fafc;
        }

        .input-group input:focus,
        .input-group select:focus {
            outline: none;
            border-color: var(--primary);
            background: white;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
            width: 100%;
        }

        .btn-primary:hover {
            background: #ea580c;
        }

        .btn-copy {
            background: #e2e8f0;
            color: var(--text);
            margin-top: 12px;
            width: 100%;
        }

        .btn-copy:hover {
            background: #cbd5e1;
        }

        .btn-row {
            display: flex;
            gap: 12px;
            margin-top: 16px;
        }

        .btn-row .btn {
            flex: 1;
        }

        .btn-pdf {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-pdf:hover {
            opacity: 0.9;
        }

        /* ç»“æœåŒºåŸŸ */
        .result-hidden {
            display: none;
        }

        .score-display {
            text-align: center;
            padding: 24px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 12px;
            color: white;
            margin-bottom: 20px;
        }

        .score-number {
            font-size: 64px;
            font-weight: 800;
            line-height: 1;
        }

        .score-label {
            font-size: 14px;
            opacity: 0.9;
            margin-top: 4px;
        }

        .tier-badge {
            display: inline-block;
            padding: 6px 16px;
            border-radius: 20px;
            font-weight: 700;
            font-size: 14px;
            margin-top: 12px;
        }

        .tier-1 { background: #fef3c7; color: #b45309; }
        .tier-2 { background: #ffedd5; color: #c2410c; }
        .tier-3 { background: #dcfce7; color: #166534; }
        .tier-4 { background: #f3f4f6; color: #4b5563; }

        /* äº”ç»´è¯„åˆ† */
        .dimension-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 20px;
        }

        .dimension-item {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .dimension-name {
            width: 70px;
            font-size: 13px;
            font-weight: 500;
        }

        .dimension-bar {
            flex: 1;
            height: 24px;
            background: #e2e8f0;
            border-radius: 12px;
            overflow: hidden;
        }

        .dimension-fill {
            height: 100%;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 8px;
            font-size: 12px;
            font-weight: 700;
            color: white;
            transition: width 0.5s ease;
        }

        .fill-speed { background: linear-gradient(90deg, #f59e0b, #ef4444); }
        .fill-power { background: linear-gradient(90deg, #ef4444, #dc2626); }
        .fill-coord { background: linear-gradient(90deg, #10b981, #059669); }
        .fill-reaction { background: linear-gradient(90deg, #06b6d4, #0891b2); }
        .fill-genetic { background: linear-gradient(90deg, #8b5cf6, #7c3aed); }
        .fill-mindset { background: linear-gradient(90deg, #f97316, #ea580c); }

        /* æ¨èé¡¹ç›® */
        .recommendation-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .recommendation-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: #f8fafc;
            border-radius: 8px;
        }

        .rec-icon {
            font-size: 24px;
        }

        .rec-info {
            flex: 1;
        }

        .rec-name {
            font-weight: 600;
            font-size: 14px;
        }

        .rec-reason {
            font-size: 12px;
            color: var(--muted);
        }

        .rec-score {
            font-weight: 700;
            color: var(--primary);
        }

        /* é¢„æµ‹èº«é«˜ */
        .prediction-box {
            background: #faf5ff;
            border: 1px solid #e9d5ff;
            border-radius: 8px;
            padding: 16px;
            text-align: center;
            margin-bottom: 20px;
        }

        .prediction-label {
            font-size: 12px;
            color: #7c3aed;
            margin-bottom: 4px;
        }

        .prediction-value {
            font-size: 28px;
            font-weight: 800;
            color: #7c3aed;
        }

        .prediction-range {
            font-size: 12px;
            color: var(--muted);
        }

        /* å¤åˆ¶æ–‡æœ¬åŒº */
        .copy-text {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 16px;
            font-size: 13px;
            white-space: pre-wrap;
            font-family: monospace;
            max-height: 300px;
            overflow-y: auto;
        }

        /* ä¸ªæ€§åŒ–æè¿° */
        .personal-desc {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border: 1px solid #f59e0b;
            border-radius: 10px;
            padding: 16px;
            margin-bottom: 20px;
            font-size: 14px;
            line-height: 1.8;
            color: #92400e;
        }

        .personal-desc .highlight {
            color: #dc2626;
            font-weight: 600;
        }

        .personal-desc .strength {
            color: #059669;
            font-weight: 600;
        }

        .personal-desc .weakness {
            color: #9333ea;
            font-weight: 500;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Orange Harmony è¯„åˆ†è®¡ç®—å™¨</h1>
        <p class="subtitle">ç®¡ç†åå° - è¾“å…¥é‚®ä»¶æ”¶åˆ°çš„æ•°æ®ï¼Œè‡ªåŠ¨è®¡ç®—è¯„åˆ†</p>

        <div class="layout">
            <!-- å·¦ä¾§ï¼šè¾“å…¥åŒº -->
            <div class="panel">
                <div class="panel-title">
                    <span>ğŸ“</span> è¾“å…¥è¯„ä¼°æ•°æ®
                </div>

                <!-- å„¿ç«¥åŸºæœ¬ä¿¡æ¯ -->
                <div class="section">
                    <div class="section-label">å„¿ç«¥ä¿¡æ¯</div>
                    <div class="input-row">
                        <div class="input-group">
                            <label>æ€§åˆ«</label>
                            <select id="gender">
                                <option value="male">ç”·</option>
                                <option value="female">å¥³</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label>èº«é«˜ (cm)</label>
                            <input type="number" id="childHeight" placeholder="125">
                        </div>
                        <div class="input-group">
                            <label>è‡‚å±• (cm)</label>
                            <input type="number" id="armSpan" placeholder="128">
                        </div>
                    </div>
                </div>

                <!-- çˆ¶æ¯ä¿¡æ¯ -->
                <div class="section">
                    <div class="section-label">çˆ¶æ¯èº«é«˜</div>
                    <div class="input-row">
                        <div class="input-group">
                            <label>çˆ¶äº² (cm)</label>
                            <input type="number" id="fatherHeight" placeholder="175">
                        </div>
                        <div class="input-group">
                            <label>æ¯äº² (cm)</label>
                            <input type="number" id="motherHeight" placeholder="162">
                        </div>
                    </div>
                </div>

                <!-- çˆ¶æ¯ç‰¹è´¨ -->
                <div class="section">
                    <div class="section-label">çˆ¶æ¯è¿åŠ¨ç‰¹è´¨</div>
                    <div class="input-row">
                        <div class="input-group">
                            <label>çˆ¶äº²ç‰¹è´¨</label>
                            <select id="fatherTrait">
                                <option value="balanced">å‡è¡¡å‘å±•</option>
                                <option value="speed">çˆ†å‘åŠ›å¼º</option>
                                <option value="endurance">è€åŠ›å‡ºä¼—</option>
                                <option value="coord">åè°ƒæ€§å¥½</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label>æ¯äº²ç‰¹è´¨</label>
                            <select id="motherTrait">
                                <option value="balanced">å‡è¡¡å‘å±•</option>
                                <option value="speed">çˆ†å‘åŠ›å¼º</option>
                                <option value="endurance">è€åŠ›å‡ºä¼—</option>
                                <option value="coord">åè°ƒæ€§å¥½</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- ç¥–çˆ¶æ¯è¿åŠ¨ç‰¹é•¿ -->
                <div class="section">
                    <div class="section-label">ç¥–çˆ¶æ¯è¿åŠ¨ç‰¹é•¿ï¼ˆæœ‰å‡ ä¸ªå¡«å‡ ä¸ªï¼‰</div>
                    <div class="input-row">
                        <div class="input-group">
                            <label>æœ‰è¿åŠ¨ç‰¹é•¿äººæ•°</label>
                            <select id="gpAthletes">
                                <option value="0">0äºº</option>
                                <option value="1">1äºº</option>
                                <option value="2">2äºº</option>
                                <option value="3">3äºº</option>
                                <option value="4">4äºº</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- æµ‹è¯•æˆç»© -->
                <div class="section">
                    <div class="section-label">æµ‹è¯•æˆç»©</div>
                    <div class="input-row">
                        <div class="input-group">
                            <label>ç«‹å®šè·³è¿œ (cm)</label>
                            <input type="number" id="standingJump" placeholder="150">
                        </div>
                        <div class="input-group">
                            <label>åä½ä½“å‰å±ˆ (cm)</label>
                            <input type="number" id="flexibility" placeholder="8">
                        </div>
                    </div>
                    <div class="input-row" style="margin-top: 12px;">
                        <div class="input-group">
                            <label>é—­çœ¼å•è„šç«™ (ç§’)</label>
                            <input type="number" id="balanceTime" placeholder="20">
                        </div>
                        <div class="input-group">
                            <label>30ç±³å†²åˆº (ç§’)</label>
                            <input type="number" id="sprintTime" placeholder="5.5" step="0.1">
                        </div>
                    </div>
                    <div class="input-row" style="margin-top: 12px;">
                        <div class="input-group">
                            <label>ååº”é€Ÿåº¦-å°ºå­æµ‹è¯• (cm)</label>
                            <input type="number" id="reactionTest" placeholder="18" step="0.5">
                        </div>
                        <div class="input-group" style="font-size: 11px; color: var(--muted); align-self: center;">
                            æµ‹è¯•æ–¹æ³•ï¼šç”¨30cmå°ºå­å‚ç›´æ‰è½ï¼Œ<br>è®°å½•å­©å­æŠ“ä½çš„åˆ»åº¦ï¼Œæ•°å€¼è¶Šå°è¶Šå¥½
                        </div>
                    </div>
                </div>

                <!-- å¿ƒç†è¯„åˆ† -->
                <div class="section">
                    <div class="section-label">å¿ƒç†è¯„åˆ† (1-5)</div>
                    <div class="input-row">
                        <div class="input-group">
                            <label>å—æ•™æ€§</label>
                            <select id="coachability">
                                <option value="3">3 - ä¸€èˆ¬</option>
                                <option value="1">1 - å¾ˆä½</option>
                                <option value="2">2 - è¾ƒä½</option>
                                <option value="4">4 - è¾ƒé«˜</option>
                                <option value="5">5 - å¾ˆé«˜</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label>æŠ—å‹æ€§</label>
                            <select id="resilience">
                                <option value="3">3 - ä¸€èˆ¬</option>
                                <option value="1">1 - å¾ˆä½</option>
                                <option value="2">2 - è¾ƒä½</option>
                                <option value="4">4 - è¾ƒé«˜</option>
                                <option value="5">5 - å¾ˆé«˜</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label>ç«äº‰æ¬²</label>
                            <select id="competitiveness">
                                <option value="3">3 - ä¸€èˆ¬</option>
                                <option value="1">1 - å¾ˆä½</option>
                                <option value="2">2 - è¾ƒä½</option>
                                <option value="4">4 - è¾ƒé«˜</option>
                                <option value="5">5 - å¾ˆé«˜</option>
                            </select>
                        </div>
                    </div>
                </div>

                <button class="btn btn-primary" onclick="calculate()">è®¡ç®—è¯„åˆ†</button>
            </div>

            <!-- å³ä¾§ï¼šç»“æœåŒº -->
            <div class="panel" id="resultPanel">
                <div class="panel-title">
                    <span>ğŸ“Š</span> è¯„ä¼°ç»“æœ
                </div>

                <div id="resultPlaceholder" style="text-align: center; color: var(--muted); padding: 60px 20px;">
                    <div style="font-size: 48px; margin-bottom: 16px;">ğŸ¯</div>
                    <div>å¡«å†™å·¦ä¾§æ•°æ®åç‚¹å‡»"è®¡ç®—è¯„åˆ†"</div>
                </div>

                <div id="resultContent" class="result-hidden">
                    <!-- ç»¼åˆåˆ†æ•° -->
                    <div class="score-display">
                        <div class="score-number" id="totalScore">--</div>
                        <div class="score-label">ç»¼åˆè¯„åˆ†</div>
                        <div class="tier-badge tier-2" id="tierBadge">Tier 2 ç«æŠ€å‚¨å¤‡</div>
                    </div>

                    <!-- ä¸ªæ€§åŒ–æè¿° -->
                    <div class="personal-desc" id="personalDesc">
                        <!-- åŠ¨æ€ç”Ÿæˆ -->
                    </div>

                    <!-- é¢„æµ‹èº«é«˜ -->
                    <div class="prediction-box">
                        <div class="prediction-label">é¢„æµ‹æˆå¹´èº«é«˜</div>
                        <div class="prediction-value" id="predictedHeight">175</div>
                        <div class="prediction-range" id="heightRange">èŒƒå›´: 171-179 cm</div>
                    </div>

                    <!-- å…­ç»´è¯„åˆ† -->
                    <div class="section-label" style="margin-bottom: 12px;">å…­ç»´è¯„åˆ†</div>
                    <div class="dimension-list">
                        <div class="dimension-item">
                            <span class="dimension-name">é€Ÿåº¦</span>
                            <div class="dimension-bar">
                                <div class="dimension-fill fill-speed" id="barSpeed" style="width: 0%"></div>
                            </div>
                        </div>
                        <div class="dimension-item">
                            <span class="dimension-name">çˆ†å‘åŠ›</span>
                            <div class="dimension-bar">
                                <div class="dimension-fill fill-power" id="barPower" style="width: 0%"></div>
                            </div>
                        </div>
                        <div class="dimension-item">
                            <span class="dimension-name">åè°ƒæ€§</span>
                            <div class="dimension-bar">
                                <div class="dimension-fill fill-coord" id="barCoord" style="width: 0%"></div>
                            </div>
                        </div>
                        <div class="dimension-item">
                            <span class="dimension-name">ååº”é€Ÿåº¦</span>
                            <div class="dimension-bar">
                                <div class="dimension-fill fill-reaction" id="barReaction" style="width: 0%"></div>
                            </div>
                        </div>
                        <div class="dimension-item">
                            <span class="dimension-name">é—ä¼ æ½œåŠ›</span>
                            <div class="dimension-bar">
                                <div class="dimension-fill fill-genetic" id="barGenetic" style="width: 0%"></div>
                            </div>
                        </div>
                        <div class="dimension-item">
                            <span class="dimension-name">å¿ƒç†éŸ§æ€§</span>
                            <div class="dimension-bar">
                                <div class="dimension-fill fill-mindset" id="barMindset" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>

                    <!-- æ¨èé¡¹ç›® -->
                    <div class="section-label" style="margin-bottom: 12px;">æ¨èè¿åŠ¨é¡¹ç›®</div>
                    <div class="recommendation-list" id="recommendations">
                        <!-- åŠ¨æ€ç”Ÿæˆ -->
                    </div>

                    <!-- æ“ä½œæŒ‰é’® -->
                    <div class="btn-row">
                        <button class="btn btn-pdf" onclick="exportPDF()">å¯¼å‡º PDF</button>
                        <button class="btn btn-copy" onclick="copyResult()">å¤åˆ¶æ–‡å­—</button>
                    </div>
                    <div class="copy-text" id="copyText" style="margin-top: 12px; display: none;"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ============ è¯„åˆ†é…ç½® ============
        const CONFIG = {
            // ç«‹å®šè·³è¿œè¯„åˆ†æ ‡å‡†
            jumpScoring: {
                male: [
                    { min: 200, score: 100 },
                    { min: 180, score: 90 },
                    { min: 160, score: 80 },
                    { min: 140, score: 70 },
                    { min: 120, score: 60 },
                    { min: 100, score: 50 },
                    { min: 0, score: 40 }
                ],
                female: [
                    { min: 180, score: 100 },
                    { min: 160, score: 90 },
                    { min: 140, score: 80 },
                    { min: 120, score: 70 },
                    { min: 100, score: 60 },
                    { min: 80, score: 50 },
                    { min: 0, score: 40 }
                ]
            },
            tierThresholds: {
                tier1: 85,
                tier2: 70,
                tier3: 55
            }
        };

        // ============ è®¡ç®—å‡½æ•° ============
        function calculate() {
            // è·å–è¾“å…¥å€¼
            const gender = document.getElementById('gender').value;
            const childHeight = parseFloat(document.getElementById('childHeight').value) || 0;
            const armSpan = parseFloat(document.getElementById('armSpan').value) || 0;
            const fatherHeight = parseFloat(document.getElementById('fatherHeight').value) || 170;
            const motherHeight = parseFloat(document.getElementById('motherHeight').value) || 160;
            const fatherTrait = document.getElementById('fatherTrait').value;
            const motherTrait = document.getElementById('motherTrait').value;
            const gpAthletes = parseInt(document.getElementById('gpAthletes').value) || 0;
            const standingJump = parseFloat(document.getElementById('standingJump').value) || 0;
            const flexibility = parseFloat(document.getElementById('flexibility').value) || 0;
            const balanceTime = parseFloat(document.getElementById('balanceTime').value) || 0;
            const sprintTime = parseFloat(document.getElementById('sprintTime').value) || 0;
            const reactionTest = parseFloat(document.getElementById('reactionTest').value) || 0;
            const coachability = parseInt(document.getElementById('coachability').value) || 3;
            const resilience = parseInt(document.getElementById('resilience').value) || 3;
            const competitiveness = parseInt(document.getElementById('competitiveness').value) || 3;

            // è®¡ç®— Ape Index
            const apeIndex = armSpan - childHeight;

            // è®¡ç®—é¢„æµ‹èº«é«˜ï¼ˆä¼˜åŒ–ç‰ˆï¼‰
            let predictedHeight;

            // åŸºç¡€é—ä¼ é¢„æµ‹ï¼ˆFPHå…¬å¼ï¼‰
            if (gender === 'male') {
                predictedHeight = Math.round((fatherHeight + motherHeight * 1.08) / 2);
            } else {
                predictedHeight = Math.round((fatherHeight * 0.923 + motherHeight) / 2);
            }

            // Ape Index è°ƒæ•´ï¼ˆè‡‚å±•é•¿çš„å­©å­é€šå¸¸æœ€ç»ˆèº«é«˜æ›´é«˜ï¼‰
            if (apeIndex > 0) {
                predictedHeight += Math.min(Math.round(apeIndex * 0.5), 4);
            }

            // å½“å‰èº«é«˜ä¿®æ­£ï¼ˆå¦‚æœå­©å­å·²ç»å¾ˆé«˜ï¼Œè¯´æ˜å‘è‚²å¥½ï¼Œé¢„æµ‹åº”ä¸Šè°ƒï¼‰
            if (childHeight > 0) {
                const ratio = childHeight / predictedHeight;

                // å¦‚æœå½“å‰èº«é«˜å·²è¾¾åˆ°é¢„æµ‹çš„95%+ï¼Œè¯´æ˜é¢„æµ‹å¯èƒ½ä¿å®ˆäº†
                if (ratio >= 0.98) {
                    // å·²ç»æ¥è¿‘æˆ–è¶…è¿‡é¢„æµ‹å€¼ï¼Œè‡³å°‘è¿˜èƒ½é•¿5-8cm
                    predictedHeight = Math.max(predictedHeight, childHeight + 7);
                } else if (ratio >= 0.95) {
                    // æ¥è¿‘é¢„æµ‹å€¼ï¼Œè¿˜æœ‰å‘è‚²ç©ºé—´
                    predictedHeight = Math.max(predictedHeight, childHeight + 10);
                } else if (ratio >= 0.90) {
                    // å‘è‚²è‰¯å¥½ï¼Œå¯èƒ½è¶…è¿‡é—ä¼ é¢„æµ‹
                    predictedHeight = Math.max(predictedHeight, Math.round(childHeight / 0.88));
                }

                // ç¥–çˆ¶æ¯è¿åŠ¨ç‰¹é•¿åŠ æˆï¼ˆè¿åŠ¨å®¶åº­çš„å­©å­é€šå¸¸å‘è‚²æ›´å¥½ï¼‰
                if (gpAthletes >= 2) {
                    predictedHeight += 2;
                }
            }

            // è®¡ç®—å…­ç»´è¯„åˆ†
            const scores = {
                speed: calculateSpeedScore(sprintTime, standingJump, gender, fatherTrait, motherTrait),
                power: calculatePowerScore(standingJump, gender, fatherTrait, motherTrait),
                coordination: calculateCoordinationScore(balanceTime, flexibility, fatherTrait, motherTrait),
                reaction: calculateReactionScore(reactionTest),
                genetic: calculateGeneticScore(fatherTrait, motherTrait, gpAthletes),
                mindset: calculateMindsetScore(coachability, resilience, competitiveness)
            };

            // è®¡ç®—ç»¼åˆåˆ†æ•°ï¼ˆå…­ç»´åŠ æƒï¼‰
            const overallScore = Math.round(
                scores.speed * 0.20 +
                scores.power * 0.20 +
                scores.coordination * 0.15 +
                scores.reaction * 0.10 +
                scores.genetic * 0.20 +
                scores.mindset * 0.15
            );

            // ç¡®å®š Tier ç­‰çº§
            let tier, tierLabel;
            if (overallScore >= CONFIG.tierThresholds.tier1) {
                tier = 1; tierLabel = 'Tier 1 ç²¾è‹±æ½œåŠ›';
            } else if (overallScore >= CONFIG.tierThresholds.tier2) {
                tier = 2; tierLabel = 'Tier 2 ç«æŠ€å‚¨å¤‡';
            } else if (overallScore >= CONFIG.tierThresholds.tier3) {
                tier = 3; tierLabel = 'Tier 3 å…´è¶£åŸ¹å…»';
            } else {
                tier = 4; tierLabel = 'Tier 4 åŸºç¡€å‘å±•';
            }

            // ç”Ÿæˆæ¨èé¡¹ç›®
            const recommendations = generateRecommendations(scores, apeIndex, flexibility);

            // æ˜¾ç¤ºç»“æœ
            displayResults(overallScore, tier, tierLabel, scores, predictedHeight, recommendations, apeIndex);
        }

        function calculateSpeedScore(sprintTime, jump, gender, fatherTrait, motherTrait) {
            let score = 60;

            if (sprintTime > 0) {
                // æœ‰å†²åˆºæˆç»©
                score = Math.max(40, 80 - (sprintTime - 4.5) * 20);
            } else if (jump > 0) {
                // ç”¨è·³è¿œæ¨ç®—
                score = getJumpScore(jump, gender) * 0.8;
            }

            // ç‰¹è´¨åŠ åˆ†
            if (fatherTrait === 'speed') score += 8;
            if (motherTrait === 'speed') score += 8;

            return clamp(Math.round(score), 0, 100);
        }

        function calculatePowerScore(jump, gender, fatherTrait, motherTrait) {
            let score = getJumpScore(jump, gender);

            if (fatherTrait === 'speed') score += 5;
            if (motherTrait === 'speed') score += 5;

            return clamp(Math.round(score), 0, 100);
        }

        function calculateCoordinationScore(balanceTime, flexibility, fatherTrait, motherTrait) {
            let score = 60;

            if (balanceTime >= 30) score = 90;
            else if (balanceTime >= 20) score = 80;
            else if (balanceTime >= 10) score = 70;
            else if (balanceTime > 0) score = 60;

            // æŸ”éŸ§æ€§è°ƒæ•´
            if (flexibility > 10) score += 5;
            else if (flexibility < -5) score -= 5;

            // ç‰¹è´¨åŠ åˆ†
            if (fatherTrait === 'coord') score += 8;
            if (motherTrait === 'coord') score += 8;

            return clamp(Math.round(score), 0, 100);
        }

        function calculateGeneticScore(fatherTrait, motherTrait, gpAthletes) {
            let score = 50;

            // çˆ¶æ¯ç‰¹è´¨åŠ åˆ†
            if (fatherTrait !== 'balanced') score += 8;
            if (motherTrait !== 'balanced') score += 8;

            // ç¥–çˆ¶æ¯è¿åŠ¨ç‰¹é•¿åŠ åˆ†
            score += gpAthletes * 5;

            return clamp(Math.round(score), 0, 100);
        }

        function calculateMindsetScore(coachability, resilience, competitiveness) {
            const weighted = coachability * 0.3 + resilience * 0.4 + competitiveness * 0.3;
            return clamp(Math.round(40 + weighted * 12), 0, 100);
        }

        // ååº”é€Ÿåº¦è¯„åˆ†ï¼ˆå°ºå­æµ‹è¯•ï¼Œcmè¶Šå°è¶Šå¥½ï¼‰
        function calculateReactionScore(reactionCm) {
            if (reactionCm <= 0) return 60; // æœªæµ‹è¯•ç»™é»˜è®¤åˆ†

            // å°ºå­æµ‹è¯•æ ‡å‡†ï¼ˆå„¿ç«¥ï¼‰ï¼š
            // ä¼˜ç§€: < 12cm (ååº”æ—¶é—´çº¦ 0.15ç§’)
            // è‰¯å¥½: 12-18cm (ååº”æ—¶é—´çº¦ 0.15-0.19ç§’)
            // ä¸€èˆ¬: 18-25cm (ååº”æ—¶é—´çº¦ 0.19-0.22ç§’)
            // è¾ƒå·®: > 25cm
            if (reactionCm < 10) return 100;
            if (reactionCm < 12) return 95;
            if (reactionCm < 15) return 88;
            if (reactionCm < 18) return 80;
            if (reactionCm < 22) return 70;
            if (reactionCm < 25) return 60;
            return 50;
        }

        function getJumpScore(distance, gender) {
            const ranges = CONFIG.jumpScoring[gender];
            for (const range of ranges) {
                if (distance >= range.min) {
                    return range.score;
                }
            }
            return 40;
        }

        function clamp(value, min, max) {
            return Math.min(Math.max(value, min), max);
        }

        function generateRecommendations(scores, apeIndex, flexibility) {
            const recommendations = [];

            // ============ ç‰¹é•¿å‹æ¨èï¼ˆæœ‰æ˜æ˜¾ä¼˜åŠ¿æ‰æ¨èï¼‰============

            // è‡‚å±•ä¼˜åŠ¿é¡¹ç›® - æ¸¸æ³³
            if (apeIndex >= 0) {
                let swimScore = 75 + apeIndex * 3; // åŸºç¡€åˆ† + è‡‚å±•åŠ æˆ
                let swimReason = '';

                if (apeIndex >= 5) {
                    swimScore = 98;
                    swimReason = 'è‡‚å±•ä¼˜åŠ¿æä½³ï¼Œæ¸¸æ³³å¤©èµ‹å‡ºä¼—';
                } else if (apeIndex >= 3) {
                    swimScore = 92;
                    swimReason = 'è‡‚å±•ä¼˜åŠ¿æ˜æ˜¾ï¼Œéå¸¸é€‚åˆæ¸¸æ³³';
                } else if (apeIndex >= 1) {
                    swimScore = 85;
                    swimReason = 'è‡‚å±•æœ‰ä¼˜åŠ¿ï¼Œé€‚åˆæ¸¸æ³³é¡¹ç›®';
                } else {
                    swimScore = 78;
                    swimReason = 'èº«ä½“æ¯”ä¾‹é€‚ä¸­ï¼Œå¯å‘å±•æ¸¸æ³³';
                }

                recommendations.push({
                    icon: 'ğŸŠ',
                    name: 'æ¸¸æ³³',
                    score: Math.min(swimScore, 100),
                    reason: swimReason
                });
            }

            // é€Ÿåº¦å‹é¡¹ç›®
            if (scores.speed >= 75) {
                recommendations.push({
                    icon: 'ğŸƒ',
                    name: 'çŸ­è·‘/ç”°å¾„',
                    score: scores.speed,
                    reason: 'é€Ÿåº¦ä¼˜åŠ¿çªå‡ºï¼Œé€‚åˆçŸ­è·‘é¡¹ç›®'
                });
            }

            // çˆ†å‘åŠ›é¡¹ç›®
            if (scores.power >= 75) {
                recommendations.push({
                    icon: 'ğŸ€',
                    name: 'ç¯®çƒ/æ’çƒ',
                    score: scores.power,
                    reason: 'çˆ†å‘åŠ›å‡ºè‰²ï¼Œé€‚åˆçƒç±»è·³è·ƒé¡¹ç›®'
                });
            }

            // åè°ƒæ€§é¡¹ç›®
            if (scores.coordination >= 75) {
                recommendations.push({
                    icon: 'ğŸ¾',
                    name: 'ç½‘çƒ/ç¾½æ¯›çƒ',
                    score: scores.coordination,
                    reason: 'åè°ƒæ€§å¥½ï¼Œé€‚åˆçƒæ‹ç±»è¿åŠ¨'
                });
            }

            // ============ ç»¼åˆæ€§è¿åŠ¨æ™ºèƒ½åŒ¹é… ============
            // æ ¹æ®å­©å­çš„ç»´åº¦ç‰¹ç‚¹æ¨èä¸åŒçš„ç»¼åˆæ€§è¿åŠ¨

            const comprehensiveSports = [];

            // ä¹’ä¹“çƒ - åè°ƒæ€§é«˜ + ååº”å¿«
            if (scores.coordination >= 65 || scores.reaction >= 75) {
                comprehensiveSports.push({
                    icon: 'ğŸ“',
                    name: 'ä¹’ä¹“çƒ',
                    score: Math.round(scores.coordination * 0.4 + scores.reaction * 0.4 + scores.speed * 0.2),
                    reason: 'åè°ƒååº”ä½³ï¼Œé€‚åˆç²¾ç»†çƒç±»è¿åŠ¨'
                });
            }

            // æ­¦æœ¯/è·†æ‹³é“ - çˆ†å‘åŠ› + å¿ƒç†éŸ§æ€§
            if (scores.power >= 60 && scores.mindset >= 60) {
                comprehensiveSports.push({
                    icon: 'ğŸ¥‹',
                    name: 'æ­¦æœ¯/è·†æ‹³é“',
                    score: Math.round(scores.power * 0.4 + scores.mindset * 0.4 + scores.coordination * 0.2),
                    reason: 'çˆ†å‘åŠ›å¼ºã€å¿ƒç†ç´ è´¨å¥½ï¼Œé€‚åˆæ ¼æ–—ç±»'
                });
            }

            // ä½“æ“ - åè°ƒæ€§ + æŸ”éŸ§æ€§å¥½
            if (scores.coordination >= 65 && flexibility > 5) {
                comprehensiveSports.push({
                    icon: 'ğŸ¤¸',
                    name: 'ä½“æ“',
                    score: Math.round(scores.coordination * 0.5 + 50 + Math.min(flexibility, 15)),
                    reason: 'åè°ƒæŸ”éŸ§ä¿±ä½³ï¼Œé€‚åˆæŠ€å·§ç±»è¿åŠ¨'
                });
            }

            // æ»‘å†°/è½®æ»‘ - åè°ƒæ€§ + å¹³è¡¡æ„Ÿ
            if (scores.coordination >= 60) {
                comprehensiveSports.push({
                    icon: 'â›¸ï¸',
                    name: 'æ»‘å†°/è½®æ»‘',
                    score: Math.round(scores.coordination * 0.7 + scores.speed * 0.3),
                    reason: 'å¹³è¡¡åè°ƒå¥½ï¼Œé€‚åˆæ»‘è¡Œç±»è¿åŠ¨'
                });
            }

            // æ”€å²© - å¿ƒç†éŸ§æ€§é«˜ + åè°ƒ
            if (scores.mindset >= 70) {
                comprehensiveSports.push({
                    icon: 'ğŸ§—',
                    name: 'æ”€å²©',
                    score: Math.round(scores.mindset * 0.5 + scores.coordination * 0.3 + scores.power * 0.2),
                    reason: 'å¿ƒç†ç´ è´¨å¼ºï¼Œé€‚åˆæŒ‘æˆ˜å‹è¿åŠ¨'
                });
            }

            // å‡»å‰‘ - ååº”é€Ÿåº¦å¿« + åè°ƒ
            if (scores.reaction >= 75) {
                comprehensiveSports.push({
                    icon: 'ğŸ¤º',
                    name: 'å‡»å‰‘',
                    score: Math.round(scores.reaction * 0.5 + scores.coordination * 0.3 + scores.speed * 0.2),
                    reason: 'ååº”æ•æ·ï¼Œé€‚åˆå¯¹æŠ—æ€§æŠ€å·§è¿åŠ¨'
                });
            }

            // è¶³çƒ - é€Ÿåº¦ + åè°ƒå‡è¡¡
            if (scores.speed >= 55 && scores.coordination >= 55) {
                comprehensiveSports.push({
                    icon: 'âš½',
                    name: 'è¶³çƒ',
                    score: Math.round((scores.speed + scores.coordination) / 2),
                    reason: 'é€Ÿåº¦åè°ƒå‡è¡¡ï¼Œé€‚åˆå›¢é˜Ÿå¯¹æŠ—'
                });
            }

            // è‡ªè¡Œè½¦ - è€åŠ›å‹ã€è…¿éƒ¨åŠ›é‡
            comprehensiveSports.push({
                icon: 'ğŸš´',
                name: 'è‡ªè¡Œè½¦',
                score: Math.round(scores.power * 0.5 + 50),
                reason: 'é”»ç‚¼è€åŠ›å’Œè…¿éƒ¨åŠ›é‡'
            });

            // æŒ‰åŒ¹é…åº¦æ’åºç»¼åˆæ€§è¿åŠ¨
            comprehensiveSports.sort((a, b) => b.score - a.score);

            // ç”¨ç»¼åˆæ€§è¿åŠ¨è¡¥å……åˆ°3ä¸ªæ¨è
            for (const sport of comprehensiveSports) {
                if (recommendations.length >= 3) break;
                // é¿å…é‡å¤ç±»å‹
                const exists = recommendations.some(r => r.name === sport.name);
                if (!exists) {
                    recommendations.push(sport);
                }
            }

            // æœ€åçš„å…œåº•ï¼šç»¼åˆä½“èƒ½è®­ç»ƒ
            if (recommendations.length < 3) {
                recommendations.push({
                    icon: 'ğŸ’ª',
                    name: 'ç»¼åˆä½“èƒ½è®­ç»ƒ',
                    score: 70,
                    reason: 'æ‰“å¥½åŸºç¡€ï¼Œä¸ºä¸“é¡¹è¿åŠ¨åšå‡†å¤‡'
                });
            }

            // æ’åºå¹¶è¿”å›å‰3ä¸ª
            recommendations.sort((a, b) => b.score - a.score);
            return recommendations.slice(0, 3);
        }

        // ç”Ÿæˆä¸ªæ€§åŒ–æè¿°
        function generatePersonalDescription(scores, apeIndex, predictedHeight) {
            const parts = [];

            // æ‰¾å‡ºä¼˜åŠ¿ç»´åº¦ï¼ˆâ‰¥75åˆ†ï¼‰
            const strengths = [];
            if (scores.speed >= 75) strengths.push('é€Ÿåº¦');
            if (scores.power >= 75) strengths.push('çˆ†å‘åŠ›');
            if (scores.coordination >= 75) strengths.push('åè°ƒæ€§');
            if (scores.reaction >= 80) strengths.push('ååº”é€Ÿåº¦');
            if (scores.genetic >= 75) strengths.push('é—ä¼ æ½œåŠ›');
            if (scores.mindset >= 75) strengths.push('å¿ƒç†éŸ§æ€§');

            // æ‰¾å‡ºå¼±åŠ¿ç»´åº¦ï¼ˆ<60åˆ†ï¼‰
            const weaknesses = [];
            if (scores.speed < 60) weaknesses.push('é€Ÿåº¦');
            if (scores.power < 60) weaknesses.push('çˆ†å‘åŠ›');
            if (scores.coordination < 60) weaknesses.push('åè°ƒæ€§');
            if (scores.reaction < 60) weaknesses.push('ååº”é€Ÿåº¦');
            if (scores.mindset < 60) weaknesses.push('å¿ƒç†éŸ§æ€§');

            // å¼€å¤´ï¼šç»¼åˆè¯„ä»·
            if (strengths.length >= 3) {
                parts.push('æ‚¨çš„å­©å­æ˜¯ä¸€ä¸ª<span class="highlight">ç»¼åˆç´ è´¨å‡ºä¼—</span>çš„è¿åŠ¨è‹—å­');
            } else if (strengths.length >= 1) {
                parts.push(`æ‚¨çš„å­©å­åœ¨<span class="strength">${strengths.join('ã€')}</span>æ–¹é¢è¡¨ç°çªå‡º`);
            } else {
                parts.push('æ‚¨çš„å­©å­ç›®å‰å¤„äºå‡è¡¡å‘å±•é˜¶æ®µ');
            }

            // è‡‚å±•ä¼˜åŠ¿
            if (apeIndex > 5) {
                parts.push(`ï¼Œè‡‚å±•æ¯”èº«é«˜é•¿<span class="highlight">${apeIndex}cm</span>ï¼Œè¿™æ˜¯æ¸¸æ³³ã€ç¯®çƒç­‰é¡¹ç›®çš„å¤©èµ‹ä¼˜åŠ¿`);
            } else if (apeIndex > 2) {
                parts.push('ï¼Œè‡‚å±•ç•¥é•¿äºèº«é«˜ï¼Œåœ¨æ°´ä¸Šè¿åŠ¨ä¸­ä¼šæœ‰ä¸€å®šä¼˜åŠ¿');
            }

            // èº«é«˜é¢„æµ‹
            if (predictedHeight >= 180) {
                parts.push(`ã€‚é¢„æµ‹æˆå¹´èº«é«˜<span class="highlight">${predictedHeight}cm</span>ï¼Œå±äºé«˜ä¸ªå­ç±»å‹ï¼Œé€‚åˆç¯®çƒã€æ’çƒç­‰éœ€è¦èº«é«˜ä¼˜åŠ¿çš„é¡¹ç›®`);
            } else if (predictedHeight >= 170) {
                parts.push(`ã€‚é¢„æµ‹æˆå¹´èº«é«˜${predictedHeight}cmï¼Œèº«é«˜é€‚ä¸­ï¼Œè¿åŠ¨é¡¹ç›®é€‰æ‹©é¢è¾ƒå¹¿`);
            } else {
                parts.push(`ã€‚é¢„æµ‹æˆå¹´èº«é«˜${predictedHeight}cmï¼Œå¯é‡ç‚¹å‘å±•çµæ´»æ€§å’ŒæŠ€å·§æ€§è¿åŠ¨`);
            }

            // ç‰¹è´¨æè¿°
            if (scores.speed >= 80 && scores.power >= 80) {
                parts.push('ã€‚<span class="strength">çˆ†å‘åŠ›å’Œé€Ÿåº¦ä¿±ä½³</span>ï¼Œæ˜¯çŸ­è·‘ã€è·³è·ƒç±»é¡¹ç›®çš„ç†æƒ³äººé€‰');
            } else if (scores.coordination >= 80 && scores.reaction >= 80) {
                parts.push('ã€‚<span class="strength">åè°ƒæ€§å¥½ã€ååº”æ•æ·</span>ï¼Œéå¸¸é€‚åˆçƒç±»è¿åŠ¨å’Œæ ¼æ–—ç±»é¡¹ç›®');
            } else if (scores.mindset >= 80) {
                parts.push('ã€‚<span class="strength">å¿ƒç†ç´ è´¨å‡ºè‰²</span>ï¼Œèƒ½å¤Ÿæ‰¿å—é«˜å¼ºåº¦è®­ç»ƒå’Œæ¯”èµ›å‹åŠ›');
            }

            // å¼±åŠ¿æé†’ï¼ˆå§”å©‰è¡¨è¾¾ï¼‰
            if (weaknesses.length > 0 && weaknesses.length <= 2) {
                parts.push(`ã€‚<span class="weakness">${weaknesses.join('å’Œ')}</span>æ–¹é¢è¿˜æœ‰æå‡ç©ºé—´ï¼Œå»ºè®®é€šè¿‡é’ˆå¯¹æ€§è®­ç»ƒåŠ å¼º`);
            }

            // å’¨è¯¢å¼•å¯¼
            const consultNote = '<br><br><span style="font-size: 12px; color: #6b7280;">ğŸ“‹ æœ¬æŠ¥å‘Šä¸ºåˆæ­¥è¯„ä¼°ï¼Œè¿åŠ¨é¡¹ç›®çš„é€‰æ‹©éœ€ç»¼åˆè€ƒè™‘èº«ä½“æ¡ä»¶ã€å‘è‚²è¶‹åŠ¿ã€å®¶æ—ç‰¹å¾ç­‰å› ç´ ã€‚å¦‚éœ€ä¸€å¯¹ä¸€è¿åŠ¨æ–¹å‘å»ºè®®ï¼Œæ¬¢è¿å’¨è¯¢ã€Œæ©™é£ç ´æµª ä½“ä¼˜æ©™é•¿ã€ä¸“ä¸šå›¢é˜Ÿã€‚</span>';

            return parts.join('') + 'ã€‚' + consultNote;
        }

        function displayResults(overallScore, tier, tierLabel, scores, predictedHeight, recommendations, apeIndex) {
            // æ˜¾ç¤ºç»“æœåŒºåŸŸ
            document.getElementById('resultPlaceholder').style.display = 'none';
            document.getElementById('resultContent').classList.remove('result-hidden');

            // ç»¼åˆåˆ†æ•°
            document.getElementById('totalScore').textContent = overallScore;

            // Tier å¾½ç« 
            const tierBadge = document.getElementById('tierBadge');
            tierBadge.textContent = tierLabel;
            tierBadge.className = 'tier-badge tier-' + tier;

            // ä¸ªæ€§åŒ–æè¿°
            const personalDesc = generatePersonalDescription(scores, apeIndex, predictedHeight);
            document.getElementById('personalDesc').innerHTML = personalDesc;

            // é¢„æµ‹èº«é«˜
            document.getElementById('predictedHeight').textContent = predictedHeight + ' cm';
            document.getElementById('heightRange').textContent = `èŒƒå›´: ${predictedHeight - 4} - ${predictedHeight + 4} cm | Ape Index: ${apeIndex > 0 ? '+' : ''}${apeIndex} cm`;

            // å…­ç»´è¯„åˆ†æ¡
            setTimeout(() => {
                document.getElementById('barSpeed').style.width = scores.speed + '%';
                document.getElementById('barSpeed').textContent = scores.speed;
                document.getElementById('barPower').style.width = scores.power + '%';
                document.getElementById('barPower').textContent = scores.power;
                document.getElementById('barCoord').style.width = scores.coordination + '%';
                document.getElementById('barCoord').textContent = scores.coordination;
                document.getElementById('barReaction').style.width = scores.reaction + '%';
                document.getElementById('barReaction').textContent = scores.reaction;
                document.getElementById('barGenetic').style.width = scores.genetic + '%';
                document.getElementById('barGenetic').textContent = scores.genetic;
                document.getElementById('barMindset').style.width = scores.mindset + '%';
                document.getElementById('barMindset').textContent = scores.mindset;
            }, 100);

            // æ¨èé¡¹ç›®
            const recContainer = document.getElementById('recommendations');
            recContainer.innerHTML = recommendations.map(rec => `
                <div class="recommendation-item">
                    <div class="rec-icon">${rec.icon}</div>
                    <div class="rec-info">
                        <div class="rec-name">${rec.name}</div>
                        <div class="rec-reason">${rec.reason}</div>
                    </div>
                    <div class="rec-score">${Math.round(rec.score)}%</div>
                </div>
            `).join('');

            // ç”Ÿæˆå¤åˆ¶æ–‡æœ¬
            generateCopyText(overallScore, tierLabel, scores, predictedHeight, recommendations, apeIndex, personalDesc);
        }

        function generateCopyText(overallScore, tierLabel, scores, predictedHeight, recommendations, apeIndex, personalDescHtml) {
            // å°†HTMLæ ‡ç­¾è½¬æ¢ä¸ºçº¯æ–‡æœ¬
            const personalDescText = personalDescHtml
                .replace(/<span class="[^"]*">/g, '')
                .replace(/<\/span>/g, '')
                .replace(/ã€‚ã€‚/g, 'ã€‚');

            const text = `
ã€æ©™é£ç ´æµª ä½“ä¼˜æ©™é•¿ Â· è¯„ä¼°æŠ¥å‘Šã€‘

ç»¼åˆè¯„åˆ†ï¼š${overallScore} åˆ†
å‘å±•ç­‰çº§ï¼š${tierLabel}

ã€ä¸ªæ€§åŒ–è¯„ä¼°ã€‘
${personalDescText}

é¢„æµ‹æˆå¹´èº«é«˜ï¼š${predictedHeight} cmï¼ˆÂ±4cmï¼‰
Ape Indexï¼š${apeIndex > 0 ? '+' : ''}${apeIndex} cm

ã€å…­ç»´è¯„åˆ†ã€‘
é€Ÿåº¦ï¼š${scores.speed}/100
çˆ†å‘åŠ›ï¼š${scores.power}/100
åè°ƒæ€§ï¼š${scores.coordination}/100
ååº”é€Ÿåº¦ï¼š${scores.reaction}/100
é—ä¼ æ½œåŠ›ï¼š${scores.genetic}/100
å¿ƒç†éŸ§æ€§ï¼š${scores.mindset}/100

ã€æ¨èè¿åŠ¨é¡¹ç›®ã€‘
${recommendations.map((r, i) => `${i + 1}. ${r.icon} ${r.name}ï¼ˆ${Math.round(r.score)}%ï¼‰- ${r.reason}`).join('\n')}

---
ğŸ“‹ æœ¬æŠ¥å‘Šä¸ºåˆæ­¥è¯„ä¼°ï¼Œè¿åŠ¨é¡¹ç›®çš„é€‰æ‹©éœ€ç»¼åˆè€ƒè™‘èº«ä½“æ¡ä»¶ã€å‘è‚²è¶‹åŠ¿ã€å®¶æ—ç‰¹å¾ç­‰å› ç´ ã€‚å¦‚éœ€ä¸€å¯¹ä¸€è¿åŠ¨æ–¹å‘å»ºè®®ï¼Œæ¬¢è¿å’¨è¯¢ã€Œæ©™é£ç ´æµª ä½“ä¼˜æ©™é•¿ã€ä¸“ä¸šå›¢é˜Ÿã€‚

æ©™é£ç ´æµª ä½“ä¼˜æ©™é•¿ Â· å„¿ç«¥è¿åŠ¨å¤©èµ‹è¯„ä¼°
            `.trim();

            document.getElementById('copyText').textContent = text;
        }

        function copyResult() {
            const copyText = document.getElementById('copyText');
            copyText.style.display = 'block';

            navigator.clipboard.writeText(copyText.textContent).then(() => {
                alert('è¯„ä¼°æŠ¥å‘Šå·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
            }).catch(() => {
                // é™çº§æ–¹æ¡ˆ
                copyText.select();
                document.execCommand('copy');
                alert('è¯„ä¼°æŠ¥å‘Šå·²å¤åˆ¶ï¼');
            });
        }

        // å¯¼å‡ºPDF
        function exportPDF() {
            const resultContent = document.getElementById('resultContent');

            if (resultContent.classList.contains('result-hidden')) {
                alert('è¯·å…ˆè®¡ç®—è¯„åˆ†ï¼');
                return;
            }

            // è·å–å½“å‰æ—¥æœŸä½œä¸ºæ–‡ä»¶å
            const today = new Date().toLocaleDateString('zh-CN').replace(/\//g, '-');
            const score = document.getElementById('totalScore').textContent;
            const filename = `æ©™é£ç ´æµªè¯„ä¼°æŠ¥å‘Š_${score}åˆ†_${today}.pdf`;

            // é…ç½®é€‰é¡¹
            const opt = {
                margin: 10,
                filename: filename,
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: {
                    scale: 2,
                    useCORS: true,
                    letterRendering: true
                },
                jsPDF: {
                    unit: 'mm',
                    format: 'a4',
                    orientation: 'portrait'
                }
            };

            // ä¸´æ—¶éšè—æŒ‰é’®
            const btnRow = document.querySelector('.btn-row');
            const copyText = document.getElementById('copyText');
            btnRow.style.display = 'none';
            copyText.style.display = 'none';

            // ç”ŸæˆPDF
            html2pdf().set(opt).from(resultContent).save().then(() => {
                // æ¢å¤æŒ‰é’®æ˜¾ç¤º
                btnRow.style.display = 'flex';
            });
        }

        // ============ URL å‚æ•°è‡ªåŠ¨å¡«å…… ============
        function parseUrlAndFill() {
            const urlParams = new URLSearchParams(window.location.search);
            const dataParam = urlParams.get('d');

            if (!dataParam) return false;

            try {
                // Base64 è§£ç 
                const jsonStr = decodeURIComponent(escape(atob(dataParam)));
                const data = JSON.parse(jsonStr);

                // å¡«å……è¡¨å•
                if (data.g) document.getElementById('gender').value = data.g === 'm' ? 'male' : 'female';
                if (data.ch) document.getElementById('childHeight').value = data.ch;
                if (data.as) document.getElementById('armSpan').value = data.as;
                if (data.fh) document.getElementById('fatherHeight').value = data.fh;
                if (data.mh) document.getElementById('motherHeight').value = data.mh;
                if (data.ft) document.getElementById('fatherTrait').value = data.ft;
                if (data.mt) document.getElementById('motherTrait').value = data.mt;
                if (data.gp !== undefined) document.getElementById('gpAthletes').value = data.gp;
                if (data.sj) document.getElementById('standingJump').value = data.sj;
                if (data.fl) document.getElementById('flexibility').value = data.fl;
                if (data.bt) document.getElementById('balanceTime').value = data.bt;
                if (data.st) document.getElementById('sprintTime').value = data.st;
                if (data.rt) document.getElementById('reactionTest').value = data.rt;
                if (data.co) document.getElementById('coachability').value = data.co;
                if (data.re) document.getElementById('resilience').value = data.re;
                if (data.cp) document.getElementById('competitiveness').value = data.cp;

                // æ˜¾ç¤ºæ¥æºæç¤º
                if (data.ct) {
                    showDataSource(data.ct);
                }

                return true;
            } catch (e) {
                console.error('URLæ•°æ®è§£æå¤±è´¥:', e);
                return false;
            }
        }

        // æ˜¾ç¤ºæ•°æ®æ¥æºæç¤º
        function showDataSource(contact) {
            const subtitle = document.querySelector('.subtitle');
            subtitle.innerHTML = `æ•°æ®å·²è‡ªåŠ¨å¡«å…… Â· æ¥æº: <strong>${contact}</strong> Â· <a href="calculator.html" style="color: var(--primary);">æ¸…ç©ºé‡å¡«</a>`;
            subtitle.style.color = '#059669';
        }

        // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥URLå‚æ•°
        window.addEventListener('DOMContentLoaded', () => {
            const hasData = parseUrlAndFill();
            if (hasData) {
                // è‡ªåŠ¨è®¡ç®—å¹¶æ˜¾ç¤ºç»“æœ
                setTimeout(() => {
                    calculate();
                }, 300);
            }
        });
    </script>
</body>
</html>
